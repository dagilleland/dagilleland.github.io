<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Identities Under IIS | Gilleland.ca</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="

The following is a copy of the excellent post by Mike O'Brien. His original post is dated in 2009, bu ...">
    <link rel="preload" href="/assets/css/0.styles.0f786b28.css" as="style"><link rel="preload" href="/assets/js/app.0edc0117.js" as="script"><link rel="preload" href="/assets/js/6.25ee4179.js" as="script"><link rel="preload" href="/assets/js/17.6810ca84.js" as="script"><link rel="preload" href="/assets/js/22.0624b457.js" as="script"><link rel="preload" href="/assets/js/8.56d32a4e.js" as="script"><link rel="prefetch" href="/assets/js/10.c352c55a.js"><link rel="prefetch" href="/assets/js/11.179534a3.js"><link rel="prefetch" href="/assets/js/12.8c28d70d.js"><link rel="prefetch" href="/assets/js/13.aa118e72.js"><link rel="prefetch" href="/assets/js/14.e68d5824.js"><link rel="prefetch" href="/assets/js/15.5904a3a4.js"><link rel="prefetch" href="/assets/js/16.fe78774d.js"><link rel="prefetch" href="/assets/js/18.fad6f82a.js"><link rel="prefetch" href="/assets/js/19.9d77efca.js"><link rel="prefetch" href="/assets/js/20.6c8a4d3d.js"><link rel="prefetch" href="/assets/js/21.4d7ff02c.js"><link rel="prefetch" href="/assets/js/23.decc4b35.js"><link rel="prefetch" href="/assets/js/24.1305f5a7.js"><link rel="prefetch" href="/assets/js/25.1da6a881.js"><link rel="prefetch" href="/assets/js/26.596c8efe.js"><link rel="prefetch" href="/assets/js/27.c9a694fc.js"><link rel="prefetch" href="/assets/js/28.8df63221.js"><link rel="prefetch" href="/assets/js/29.2de4008a.js"><link rel="prefetch" href="/assets/js/3.f48304fb.js"><link rel="prefetch" href="/assets/js/30.69ed8ef7.js"><link rel="prefetch" href="/assets/js/31.52d4962d.js"><link rel="prefetch" href="/assets/js/32.0a4598d3.js"><link rel="prefetch" href="/assets/js/4.8e8a1415.js"><link rel="prefetch" href="/assets/js/5.04a6564d.js"><link rel="prefetch" href="/assets/js/7.be6c9ddb.js"><link rel="prefetch" href="/assets/js/9.26591758.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.7519f153.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0f786b28.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">Gilleland.ca </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/about/dan.html" class="nav-link">Home</a></li><li class="nav-item"><a href="/articles/" class="nav-link">Articles</a></li><li class="nav-item"><a href="/archive/" class="nav-link">Archive</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/blog/" class="nav-link">Blog</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">Gilleland.ca </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/about/dan.html" class="nav-link">Home</a></li><li class="mobile-nav-item"><a href="/articles/" class="nav-link">Articles</a></li><li class="mobile-nav-item"><a href="/archive/" class="nav-link">Archive</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/blog/" class="nav-link">Blog</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div><div class="content__default"><h1 id="identities-under-iis"><a href="#identities-under-iis" class="header-anchor">#</a> Identities Under IIS</h1> <p>The following is a copy of the <a href="http://www.mikeobrien.net/blog/identities-for-different-iis7" target="_blank" rel="noopener noreferrer">excellent post<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> by <a href="http://www.mikeobrien.net/cv/" target="_blank" rel="noopener noreferrer">Mike O'Brien<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. His original post is dated in 2009, but it's information is <em><strong>very</strong></em> helpful for anyone trying to make sense of how Identities are extablished under the various IIS authentication configurations.</p> <p>It's so good, I'm simply afraid that one day it might be lost, so I'm capturing it here for my own reference.</p> <h2 id="identities-for-different-iis7-authentication-configurations-january-2009"><a href="#identities-for-different-iis7-authentication-configurations-january-2009" class="header-anchor">#</a> Identities for different IIS7 Authentication Configurations January, 2009</h2> <p>A few notes about identities from the standpoint of ASP.NET:</p> <p><strong><a href="http://msdn.microsoft.com/en-us/library/system.security.principal.windowsidentity.getcurrent.aspx" target="_blank" rel="noopener noreferrer">WindowsIdentity.GetCurrent()<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong> - This WindowsIdentity represents the OS thread identity or more specifically an <a href="http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/WhatIsAToken.html" target="_blank" rel="noopener noreferrer">account token<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> (Not to be confused with <a href="http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/WhatIsThreadDotCurrentPrincipal.html" target="_blank" rel="noopener noreferrer">Thread.CurrentPrincipal.Identity<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which is just a simple container for your convenience). This token represents a LSA (Local Security Authority) or Active Directory account. This will always be the process identity set in the App Pool configuration (AKA the App Pool identity) unless you are doing impersonation. This is the actual identity (Or Windows account token) that code runs as. As far as Windows Security is concerned this is the only identity that matters. The only way to &quot;change&quot; this is to do <a href="http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/WhatIsImpersonation.html" target="_blank" rel="noopener noreferrer">impersonation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which is done on a thread by thread basis and should be reverted ASAP to the original identity to avoid a security hole (And resource leak because of unclosed handles). New threads always inherit the process token regardless of if the creating thread is impersonating another user (Something to remember when doing async calls in ASP.NET while impersonating).</p> <p><strong><a href="http://msdn.microsoft.com/en-us/library/system.threading.thread.currentprincipal.aspx" target="_blank" rel="noopener noreferrer">Thread.CurrentPrinciple.Identity<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> &amp; <a href="http://msdn.microsoft.com/en-us/library/system.web.httpcontext.user.aspx" target="_blank" rel="noopener noreferrer">HttpContext.Current.User.Identity<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong> - These are set by ASP.NET during the authentication phase and will either be...</p> <ol><li>...an Anonymous WindowsIdentity when doing just anonymous auth</li> <li>...a GenericIdentity when doing forms auth (Which implies anon auth).</li> <li>...a custom identity when doing custom auth (Which implies anon auth).</li> <li>...a WindowsIdentity representing the authenticating user when doing any other types of auth such as Basic, Windows or Challenge-Response. These two properties actually point to the same instance of the identity. This will be the same as the OS thread <em><strong>only</strong></em> when you are doing impersonation.</li></ol> <p><strong><a href="http://msdn.microsoft.com/en-us/library/system.web.httprequest.logonuseridentity.aspx" target="_blank" rel="noopener noreferrer">Request.LogonUserIdentity<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong> - This is a WindowsIdentity representing the authenticating user, regardless of the authentication type. This will be the same as the OS thread <em><strong>only</strong></em> when you are doing impersonation. It will be the same as Thread.CurrentPrinciple.Identity &amp; HttpContext.Current.User.Identity only when you are not doing anonymous authentication.</p> <p>Here is a listing of the identities set by IIS7 auth in a number of configurations. They remained the same in both integrated and classic pipeline modes.</p> <h3 id="anonymous-specific-user-which-happens-to-be-iusr"><a href="#anonymous-specific-user-which-happens-to-be-iusr" class="header-anchor">#</a> Anonymous (Specific User, which happens to be IUSR)</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>NT AUTHORITYNETWORK SERVICE</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td>NT AUTHORITYIUSR</td></tr></tbody></table> <h3 id="anonymous-specific-user-which-happens-to-be-iusr-impersonation"><a href="#anonymous-specific-user-which-happens-to-be-iusr-impersonation" class="header-anchor">#</a> Anonymous (Specific User, which happens to be IUSR), Impersonation</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>NT AUTHORITYIUSR</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td>NT AUTHORITYIUSR</td></tr></tbody></table> <h3 id="anonymous-app-pool-identity-which-happens-to-be-network-service"><a href="#anonymous-app-pool-identity-which-happens-to-be-network-service" class="header-anchor">#</a> Anonymous (App Pool Identity, which happens to be NETWORK SERVICE)</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>NT AUTHORITYNETWORK SERVICE</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td>NT AUTHORITYNETWORK SERVICE</td></tr></tbody></table> <h3 id="anonymous-app-pool-identity-which-happens-to-be-network-service-impersonation"><a href="#anonymous-app-pool-identity-which-happens-to-be-network-service-impersonation" class="header-anchor">#</a> Anonymous (App Pool Identity, which happens to be NETWORK SERVICE), Impersonation</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>NT AUTHORITYNETWORK SERVICE</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td>NT AUTHORITYNETWORK SERVICE</td></tr></tbody></table> <h3 id="anonymous-physical-path-credentials-lsa-user"><a href="#anonymous-physical-path-credentials-lsa-user" class="header-anchor">#</a> Anonymous, Physical Path Credentials, LSA User</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>NT AUTHORITYNETWORK SERVICE</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td>HOSTusername</td></tr></tbody></table> <h3 id="anonymous-impersonation-physical-path-credentials-lsa-user"><a href="#anonymous-impersonation-physical-path-credentials-lsa-user" class="header-anchor">#</a> Anonymous, Impersonation, Physical Path Credentials, LSA User</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>NTLM</td> <td>HOSTusername</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td></td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td>HOSTusername</td></tr></tbody></table> <h3 id="basic-lsa-user-same-for-ad-user"><a href="#basic-lsa-user-same-for-ad-user" class="header-anchor">#</a> Basic, LSA User (Same for AD user)</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>NT AUTHORITYNETWORK SERVICE</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>HOSTusername</td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>HOSTusername</td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>HOSTusername</td></tr></tbody></table> <h3 id="impersonation-basic-auth-and-lsa-user-classic-pipeline-mode-or-integrated-pipeline-and-validateintegratedmodeconfiguration-false"><a href="#impersonation-basic-auth-and-lsa-user-classic-pipeline-mode-or-integrated-pipeline-and-validateintegratedmodeconfiguration-false" class="header-anchor">#</a> Impersonation, Basic Auth, and LSA User (Classic Pipeline Mode or Integrated Pipeline and validateIntegratedModeConfiguration=false)</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>NTLM</td> <td>HOSTusername</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>HOSTusername</td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>HOSTusername</td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>HOSTusername</td></tr></tbody></table> <h3 id="impersonation-basic-auth-and-ad-user-classic-pipeline-mode-or-integrated-pipeline-and-validateintegratedmodeconfiguration-false"><a href="#impersonation-basic-auth-and-ad-user-classic-pipeline-mode-or-integrated-pipeline-and-validateintegratedmodeconfiguration-false" class="header-anchor">#</a> Impersonation, Basic Auth, and AD User (Classic Pipeline Mode or Integrated Pipeline and validateIntegratedModeConfiguration=false)</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Kerberos</td> <td>DOMAINusername</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>DOMAINusername</td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>DOMAINusername</td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Basic</td> <td>DOMAINusername</td></tr></tbody></table> <h3 id="forms-anonymous-auth"><a href="#forms-anonymous-auth" class="header-anchor">#</a> Forms, Anonymous Auth</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>NT AUTHORITYNETWORK SERVICE</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.GenericIdentity</td> <td></td> <td></td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.GenericIdentity</td> <td></td> <td></td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td></td> <td>NT AUTHORITYIUSR</td></tr></tbody></table> <h3 id="windows-lsa-user-same-for-ad-user"><a href="#windows-lsa-user-same-for-ad-user" class="header-anchor">#</a> Windows, LSA User (Same for AD user)</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>NT AUTHORITYNETWORK SERVICE</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>HOSTusername</td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>HOSTusername</td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>HOSTusername</td></tr></tbody></table> <h3 id="impersonation-windows-auth-and-lsa-user-classic-pipeline-mode-or-integrated-pipeline-and-validateintegratedmodeconfiguration-false"><a href="#impersonation-windows-auth-and-lsa-user-classic-pipeline-mode-or-integrated-pipeline-and-validateintegratedmodeconfiguration-false" class="header-anchor">#</a> Impersonation, Windows Auth, and LSA User (Classic Pipeline Mode or Integrated Pipeline and validateIntegratedModeConfiguration=false)</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>NTLM</td> <td>HOSTusername</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>HOSTusername</td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>HOSTusername</td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>HOSTusername</td></tr></tbody></table> <h3 id="impersonation-windows-auth-and-ad-user-classic-pipeline-mode-or-integrated-pipeline-and-validateintegratedmodeconfiguration-false"><a href="#impersonation-windows-auth-and-ad-user-classic-pipeline-mode-or-integrated-pipeline-and-validateintegratedmodeconfiguration-false" class="header-anchor">#</a> Impersonation, Windows Auth, and AD User (Classic Pipeline Mode or Integrated Pipeline and validateIntegratedModeConfiguration=false)</h3> <table><thead><tr><th>Source</th> <th>Type</th> <th>Return Type</th> <th>Authentication Type</th> <th>Identity Name</th></tr></thead> <tbody><tr><td>WindowsIdentity.GetCurrent()</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Kerberos</td> <td>DOMAINusername</td></tr> <tr><td>Thread.CurrentPrincipal.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>DOMAINusername</td></tr> <tr><td>HttpContext.Current.User.Identity</td> <td>IIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>DOMAINusername</td></tr> <tr><td>Request.LogonUserIdentity</td> <td>WindowsIdentity</td> <td>System.Security.Principal.WindowsIdentity</td> <td>Negotiate</td> <td>DOMAINusername</td></tr></tbody></table> <p><a href="http://www.mikeobrien.net/blog/tags#tag-3" target="_blank" rel="noopener noreferrer">.NET<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="http://www.mikeobrien.net/blog/tags#tag-48" target="_blank" rel="noopener noreferrer">IIS 7<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div></div></div> <footer class="footer" data-v-fdbf4940><div class="footer-left-wrap" data-v-fdbf4940><ul class="contact" data-v-fdbf4940></ul></div> <div class="footer-right-wrap" data-v-fdbf4940><ul class="copyright" data-v-fdbf4940></ul></div></footer></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.0edc0117.js" defer></script><script src="/assets/js/6.25ee4179.js" defer></script><script src="/assets/js/17.6810ca84.js" defer></script><script src="/assets/js/22.0624b457.js" defer></script><script src="/assets/js/8.56d32a4e.js" defer></script>
  </body>
</html>
